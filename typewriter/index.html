<!DOCTYPE html>
<html>
<head>
<style>
body {
  margin: 0;
  background: black;
  height: 100vh;
  overflow: hidden;
}

/* Paper */
#paper-container {
  position: fixed;
  bottom: -500px;
  left: 50%;
  transform: translateX(-50%);
  width: 800px;
  z-index: 0;
  transition: transform 0.35s ease;
}

#paper {
  width: 800px;
  display: block;
}

/* Text */
#paper-text {
  position: absolute;
  top: 100px;
  left: 0px;
  font-family: "Courier New", monospace;
  font-size: 22px;
  color: black;
  white-space: nowrap;
}

/* Typewriter bar */
#typewriter-bar {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  max-width: 1800px;
  z-index: 1;
}

/* Fixed typing spot */
#typing-spot {
  position: fixed;
  bottom: 60px;
  left: 50%;
  transform: translateX(-50%);
  width: 22px;
  height: 20px;
  pointer-events: none;
  z-index: 2;
}
</style>
</head>
<body>

<div id="paper-container">
  <img id="paper" src="images/paper.png">
  <div id="paper-text"></div>
</div>

<img id="typewriter-bar" src="images/twfront.png">
<div id="typing-spot"></div>

<script>

const paper = document.getElementById("paper-container");
const textLayer = document.getElementById("paper-text");
const typingSpot = document.getElementById("typing-spot");

const maxRight = 360;
const step = 14;
const lineHeight = 28;
const paperWidth = 800;
const leftMargin = 80;
const rightMargin = 80;
const usableWidth = paperWidth - leftMargin - rightMargin;

let offset = 0;
let textLineOffset = 0;
let paperLineOffset = 0;
let column = 0;
let isEnterPressed = false;

/* ===============================
   UPDATE TRANSFORM
=================================*/
function updatePaperTransform(scale = 1) {
  paper.style.transform =
    `translateX(calc(-50% - ${offset}px))
     translateY(${paperLineOffset}px)
     scale(${scale})`;
}

/* ===============================
   TYPE LETTER
=================================*/
document.addEventListener("keydown", (event) => {

  const isTypingKey =
    event.key.length === 1 || event.key === " ";

  const hasModifier =
    event.metaKey || event.ctrlKey || event.altKey;

  /* TYPE */
  if (isTypingKey && !hasModifier && !event.repeat) {

    const letter = document.createElement("span");
    letter.textContent = event.key;
    letter.style.position = "absolute";

    const typingRect = typingSpot.getBoundingClientRect();
    const paperRect = paper.getBoundingClientRect();

    const leftPosition = typingRect.left - paperRect.left - 25;

    letter.style.left = leftPosition + "px";
    letter.style.top = textLineOffset + "px";

    textLayer.appendChild(letter);

    column++;
    offset = column * step;

    updatePaperTransform(1);

    event.preventDefault();
  }

  /* BACKSPACE  ✅ FIXED — COLUMN BASED */
  if (event.key === "Backspace") {

    column = Math.max(0, column - 1);
    offset = column * step;

    updatePaperTransform(1);

    event.preventDefault();
  }

  /* ENTER PRESS */
  if (event.key === "Enter" && !isEnterPressed) {

    isEnterPressed = true;

    paper.style.transform =
      `translateX(calc(-50% - ${offset}px))
       translateY(${paperLineOffset}px)
       scale(0.97)`;

    event.preventDefault();
  }

});

/* ===============================
   ENTER RELEASE
=================================*/
document.addEventListener("keyup", (event) => {

if (event.key === "Enter") {

  isEnterPressed = false;

  /* Move text down */
  textLineOffset += lineHeight;

  /* Feed paper up */
  paperLineOffset -= lineHeight;

  /* Force carriage to far right */
  offset = maxRight;

  paper.style.transition = "transform 0.35s ease";
  updatePaperTransform(1);

  setTimeout(() => {
    paper.style.transition = "none";
  }, 350);

}

});

</script>
</body>
</html>
